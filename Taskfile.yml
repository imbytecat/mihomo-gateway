# https://taskfile.dev
version: "3"

tasks:
  default:
    desc: Show available tasks
    cmds:
      - task --list

  # ============================================================
  # Build
  # ============================================================
  build:
    desc: Build NixOS system configuration
    cmds:
      - nix build .#default
      - echo "Output -> ./result"

  tarball:
    desc: Build LXC tarball (CI friendly, no privilege required)
    cmds:
      - nix build .#tarball
      - echo "Output -> ./result/tarball/*.tar.xz"

  # ============================================================
  # Development
  # ============================================================
  dev:
    desc: Enter development shell with Nix tools
    cmds:
      - nix develop

  fmt:
    desc: Format all Nix files
    cmds:
      - nix fmt

  check:
    desc: Check flake and evaluate configurations
    cmds:
      - nix flake check

  update:
    desc: Update flake.lock
    cmds:
      - nix flake update

  # ============================================================
  # Utility
  # ============================================================
  clean:
    desc: Clean build outputs
    cmds:
      - rm -rf result result-*
